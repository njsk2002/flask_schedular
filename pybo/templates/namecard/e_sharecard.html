{% extends 'e_base.html' %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4">ë‚´ ê³µìœ  ëª…í•¨ ëª©ë¡</h2>

    {% if error_message %}
        <div class="alert alert-danger" role="alert">
            {{ error_message }}
        </div>
    {% endif %}

    <div id="sharecard-container" class="row row-cols-1 row-cols-md-2 g-4">
        {% for share in namecards %}
        <div class="col">
            <div class="card shadow-sm">
                <div class="card-body">
                    
                    <!-- âœ… ì œëª© (í¬ê²Œ ê°•ì¡°) -->
                    <h4 class="card-title title-box">{{ share.title }}</h4>

                    <!-- âœ… ì¸ì‚¬ë§ -->
                    <div class="message-box">
                        <h6>ğŸ’¬ ì¸ì‚¬ë§</h6>
                        <p>{{ share.introduce or 'ì—†ìŒ' }}</p>
                    </div>

                    <!-- âœ… ë‚´ìš© -->
                    <div class="content-box">
                        <h6>ğŸ“„ ë‚´ìš©</h6>
                        <p>{{ share.content }}</p>
                    </div>

                    <!-- âœ… ëª…í•¨ ì •ë³´ (ìŠ¤íƒ€ì¼ ì¶”ê°€) -->
                    {% if share.namecard %}
                        <div class="namecard-box mt-3 p-3">
                            <h6>ğŸ“Œ ëª…í•¨ ì •ë³´</h6>
                            <div class="d-flex align-items-center">
                                <!-- í”„ë¡œí•„ ì‚¬ì§„ -->
                                <img src="{{ share.namecard.selected_photo or '/static/default_profile.jpg' }}" 
                                     class="rounded-circle profile-img me-3">
                            
                                <div>
                                    <!-- ì´ë¦„ ë° ì§ê¸‰ -->
                                    <strong class="name-highlight">{{ share.namecard.username or 'ì´ë¦„ ì—†ìŒ' }}</strong> 
                                    ({{ share.namecard.position or 'ì§ê¸‰ ì—†ìŒ' }})<br>
                                    
                                    <!-- íšŒì‚¬ëª… -->
                                    <span class="company-text">ğŸ¢ {{ share.namecard.company or 'íšŒì‚¬ ì—†ìŒ' }}</span><br>
                                    
                                    <!-- ì´ë©”ì¼ -->
                                    ğŸ“§ <a href="mailto:{{ share.namecard.email }}" class="email-text">
                                        {{ share.namecard.email or 'ì´ë©”ì¼ ì—†ìŒ' }}
                                    </a> <br>
                                    
                                    <!-- ìŠ¤ë§ˆíŠ¸í° ì „í™”ë²ˆí˜¸ -->
                                    ğŸ“± {{ share.namecard.phone or 'ì „í™” ì—†ìŒ' }} <br>
                                    
                                    <!-- ëŒ€í‘œ ì „í™” & ì§í†µ ì „í™” -->
                                    â˜ <span class="company-text">{{ share.namecard.tel_rep or 'ëŒ€í‘œë²ˆí˜¸ ì—†ìŒ' }} 
                                        | ğŸ“ {{ share.namecard.tel_dir or 'ì§í†µë²ˆí˜¸ ì—†ìŒ' }}
                                    </span> <br>
                            
                                    <!-- íŒ©ìŠ¤ -->
                                    ğŸ“  <span class="fax-text">{{ share.namecard.fax or 'íŒ©ìŠ¤ ì—†ìŒ' }}</span><br>
                            
                                    <!-- ì£¼ì†Œ -->
                                    ğŸ“ <span class="address-text">{{ share.namecard.com_address or 'ì£¼ì†Œ ì—†ìŒ' }}</span><br>

                                    <!-- í™ˆí˜ì´ì§€ (í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½) -->
                                    ğŸŒ <a href="http://{{ share.namecard.homepage }}" target="_blank" class="homepage-text">
                                        {{ share.namecard.homepage or 'í™ˆí˜ì´ì§€ ì—†ìŒ' }}
                                    </a>
                                </div>
                            </div>
                            
                        </div>
                    {% else %}
                        <p class="text-muted">ëª…í•¨ ì •ë³´ ì—†ìŒ</p>
                    {% endif %}

                    <!-- âœ… ê³µìœ ëœ íŒŒì¼ ë¦¬ìŠ¤íŠ¸ -->
                    <div class="file-box mt-3 p-3">
                        <h6>ğŸ“‚ ê³µìœ í•  íŒŒì¼</h6>
                        {% if share.shared_files and share.shared_files|length > 0 %}
                            <ul class="file-list">
                                {% for file in share.shared_files %}
                                    <li>
                                        <i class="bi bi-file-earmark-text"></i> {{ file }}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p class="text-muted">ê³µìœ ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                        {% endif %}
                    </div>

                    <p class="text-muted small">ğŸ“… ì‘ì„±ì¼: {{ share.created_at or 'ë‚ ì§œ ì—†ìŒ' }}</p>
                </div>

                <<!-- âœ… "ì„ íƒ" ë²„íŠ¼ (ì¢Œì¸¡ í•˜ë‹¨, í¬ê¸° í™•ëŒ€) -->
                <div class="select-button-container">
                    <button type="button" class="btn btn-primary select-btn" 
                            onclick="confirmSelection('{{ share.no }}', '{{ share.namecard_id }}')">
                        ì„ íƒ
                    </button>
                </div>

            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}




{% block extra_css %}
<link rel="stylesheet" href="/static/e_css/e_sharecard.css">
{% endblock %}

{% block script %}
<script>
    function confirmSelection(shareNo, namecardId) {
        if (confirm("ì´ ê³µìœ  ëª…í•¨ì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            // POST ìš”ì²­ìœ¼ë¡œ share.no ê°’ì„ ì „ë‹¬
            fetch('/enamecard/gen_welcome', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    share_no: shareNo,
                    namecard_id: namecardId
                 })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("ì„ íƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
                    window.location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì„ íƒ ì™„ë£Œ í›„)
                } else {
                    alert("ì˜¤ë¥˜ ë°œìƒ: " + data.message);
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
        }
    }
</script>
{% endblock %}

