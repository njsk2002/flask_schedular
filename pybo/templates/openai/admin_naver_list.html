<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Naver List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        h5 {
            font-size: 1rem;
            font-family: 'Arial', sans-serif;
            color: #343a40;
        }
        p {
            font-size: 0.875rem;
            font-family: 'Arial', sans-serif;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center">📚 Admin Image List</h1>
        <div class="d-flex justify-content-end mt-3">
            <select id="selecttype" class="form-select me-2" style="width: auto;">
                <option value="아이유" selected>아이유</option>
                <option value="임영웅">임영웅</option>
                <option value="카리나">카리나</option>
                <option value="권지용">권지용</option>
            </select>

            <select id="selectimage" class="form-select me-2" style="width: auto;">
                <option value="image" selected>Image</option>
                <option value="news">News</option>
                <option value="blog">Blog</option>
                <option value="youtube">UTUBE</option>
            </select>

            <button id="generateBtn" class="btn btn-primary">IMAGE 생성</button>
        </div>
    
        <!-- 메시지 출력 -->
        {% if message %}
            <div class="alert alert-info mt-4 text-center">
                {{ message }}
            </div>
        {% endif %}
    
        <!-- 이미지 리스트 출력 -->
        <div id="imageContainer" class="mt-4">
            {% if data %}
                {% for image in data %}
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <!-- 이미지 URL 표시 -->
                                <img src="{{ image.url}}" alt="{{ image.title_image }}" style="width: 100%; height: auto;" />
                            </div>
                            <div class="col-md-8">
                                <!-- <p><strong>{{ image.title_image }}</strong></p> -->
                                <!-- <p>Update Date: {{ image.update_date }}</p> -->
                                <p>크게 보기:</strong> <a href="{{ image.url }}" target="_blank">View Full Image</a></p>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                <button id="loadMoreBtn" class="btn btn-primary">더보기</button>
            {% else %}
                <p class="text-center">표시할 데이터가 없습니다.</p>
            {% endif %}
        </div>
        
    </div>
    

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">자료 변환중...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

   <!-- Bootstrap JS -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

   <script>
       $(document).ready(function () {
           let currentPage = 1;  // 현재 페이지
           const perPage = 10;   // 페이지당 항목 수

           $('#generateBtn').on('click', function () {
               $('#loadingModal').modal('show');

               // 선택된 값 가져오기
               const selectedType = $('#selecttype').val();
               const selectedImage = $('#selectimage').val();

               // POST 요청
               $.ajax({
                   url: '/naverapi/generate_image',
                   method: 'POST',
                   contentType: 'application/json',
                   data: JSON.stringify({
                       key_word: selectedType,
                       request_type: selectedImage
                   }),
                   success: function (response) {
                       // 서버에서 데이터가 빈 경우 처리
                       if (response.length === 0) {
                           $('#imageContainer').html('<p class="text-center">표시할 데이터가 없습니다.</p>');
                       } else {
                           renderImages(response);
                       }
                   },
                   error: function () {
                       alert('Error generating images.');
                   },
                   complete: function () {
                       $('#loadingModal').modal('hide');
                   }
               });
           });

           const renderImages = (images) => {
               const imageContainer = $('#imageContainer');

               images.forEach(image => {
                   const imageHtml = `
                       <div class="card mb-4">
                           <div class="card-body">
                               <div class="row">
                                   <div class="col-md-4 text-center">
                                       <img src="${image.url}" alt="${image.title_image}" style="width: 100%; height: auto;" />
                                   </div>
                                   <div class="col-md-8">
                                       <h5>${image.title_image}</h5>
                                       <p><strong>Update Date:</strong> ${image.update_date}</p>
                                       <p><strong>Thumbnail:</strong> ${image.thumbnail}</p>
                                   </div>
                               </div>
                           </div>
                       </div>
                   `;
                   imageContainer.append(imageHtml);
               });
           };

           const loadImages = () => {
               $.ajax({
                   url: '/naverapi/admin_image',
                   method: 'GET',
                   data: { 
                    page: currentPage, 
                    per_page: perPage 
                },
                   success: function (response) {
                       if (response.data.length > 0) {
                           response.data.forEach(image => {
                               const imageHtml = `
                                   <div class="card mb-4">
                                       <div class="card-body">
                                           <div class="row">
                                               <div class="col-md-4 text-center">
                                                   <img src="${image.url}" alt="${image.title_image}" style="width: 100%; height: auto;" />
                                               </div>
                                               <div class="col-md-8">
                                                   <h5>${image.title_image}</h5>
                                                   <p><strong>Update Date:</strong> ${image.update_date}</p>
                                                   <p><strong>Thumbnail:</strong> ${image.thumbnail}</p>
                                               </div>
                                           </div>
                                       </div>
                                   </div>
                               `;
                               $('#imageContainer').append(imageHtml);
                           });

                           // 페이지 증가
                           currentPage += 1;
                       } else {
                           alert("더 이상 데이터가 없습니다.");
                           $('#loadMoreBtn').hide();
                       }
                   },
                   error: function () {
                       alert("데이터를 불러오는 중 오류가 발생했습니다.");
                   }
               });
           };

           // 초기 데이터 로드
           loadImages();

           // "더보기" 버튼 클릭 이벤트
           $('#loadMoreBtn').on('click', function () {
               console.log("버튼 클릭");
               if (currentPage == 1){
                 currentPage = 2;
                 loadImages();
               }
               loadImages();
           });
       });
   </script>
</body>
</html>
