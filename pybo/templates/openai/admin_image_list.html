<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Naver List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        h5 {
            font-size: 1rem;
            font-family: 'Arial', sans-serif;
            color: #343a40;
        }
        p {
            font-size: 0.875rem;
            font-family: 'Arial', sans-serif;
            color: #6c757d;
        }


        /* ì „ì²´ í™”ë©´ íŒì—… ìŠ¤íƒ€ì¼ */
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            cursor: pointer;
        }

        .fullscreen-modal img {
            max-width: 90%;
            max-height: 90%;
            display: block;
            margin: auto;
            border-radius: 8px;
        }

        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: white;
            cursor: pointer;
        }
    </style>

</head>
<body>
    <div class="container py-5">
        <h1 class="text-center">ğŸ“š Admin Image List</h1>
        <div class="d-flex justify-content-end mt-3">
            <select id="selecttype" class="form-select me-2" style="width: auto;">
                <option value="ì•„ì´ìœ " selected>ì•„ì´ìœ </option>
                <option value="ì„ì˜ì›…">ì„ì˜ì›…</option>
                <option value="ì¹´ë¦¬ë‚˜">ì¹´ë¦¬ë‚˜</option>
                <option value="ê¶Œì§€ìš©">ê¶Œì§€ìš©</option>
            </select>

            <select id="selectimage" class="form-select me-2" style="width: auto;">
                <option value="image" selected>Image</option>
                <option value="news">News</option>
                <option value="blog">Blog</option>
                <option value="youtube">UTUBE</option>
            </select>

            <button id="generateBtn" class="btn btn-primary">IMAGE ìƒì„±</button>
        </div>
    
        <!-- ë©”ì‹œì§€ ì¶œë ¥ -->
        {% if message %}
            <div class="alert alert-info mt-4 text-center">
                {{ message }}
            </div>
        {% endif %}
    
        <!-- ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ ì¶œë ¥ -->
        <div id="imageContainer" class="mt-4">
            {% if data %}
                {% for image in data %}
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <!-- ê¸°ë³¸ ì´ë¯¸ì§€ëŠ” JPG URL í‘œì‹œ -->
                                <img id="image-{{ loop.index }}" src="{{ image.url }}" alt="{{ image.title_image }}" style="width: 100%; height: auto;" />
                                <!-- <button class="btn btn-primary toggle-format" data-index="{{ loop.index }}" data-jpg="{{ image.url }}" data-bmp="/naverapi/bmp_files/{{ image.bmp_file }}">BMP ë³´ê¸°</button> -->
                            </div>
                            <div class="col-md-8">
                                <!-- ì´ë¯¸ì§€ ì •ë³´ì™€ ë²„íŠ¼ -->
                                <!-- <p><a id="link-{{ loop.index }}" href="{{ image.url }}" target="_blank"><strong>í¬ê²Œ ë³´ê¸°</strong> </a></p> -->
                                <!-- ë²„íŠ¼ìœ¼ë¡œ ë§í¬ -->
                                <button id="link-{{ loop.index }}" class="btn btn-outline-primary btn-sm me-2" onclick="openFullscreen('{{ image.url }}')">
                                    <i class="fas fa-search-plus"></i> í¬ê²Œ ë³´ê¸°
                                </button>
                                <button class="btn btn-outline-success btn-sm toggle-format" data-index="{{ loop.index }}" data-jpg="{{ image.url }}" data-bmp="/naverapi/bmp_files/{{ image.bmp_file }}">
                                    <i class="fas fa-sync-alt"></i> BMP ë³´ê¸°
                                </button>
                                
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
               
            {% else %}
                <p class="text-center">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </div>
        <button id="loadMoreBtn" class="btn btn-primary">ë” ë³´ê¸° </button>

        <!-- ì „ì²´ í™”ë©´ íŒì—… -->
        <div id="fullscreenModal" class="fullscreen-modal" onclick="closeFullscreen()">
            <span id="closeButton" class="close-button" onclick="closeFullscreen()">&#x2715;</span>
            <img id="fullscreenImage" src="" alt="Fullscreen Image" />
        </div>
        <!-- <div id="fullscreenModal" class="fullscreen-modal">
            <span id="closeButton" class="close-button">&#x2715;</span>
            <img id="fullscreenImage" src="" alt="Fullscreen Image" />
        </div>
         -->
        
    </div>
    

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-3">ìë£Œ ë³€í™˜ì¤‘...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

   <script>
       $(document).ready(function () {
           let currentPage = 1;  // í˜„ì¬ í˜ì´ì§€
           const perPage = 10;   // í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜

           $('#generateBtn').on('click', function () {
               $('#loadingModal').modal('show');

               // ì„ íƒëœ ê°’ ê°€ì ¸ì˜¤ê¸°
               const selectedType = $('#selecttype').val();
               const selectedImage = $('#selectimage').val();

               // POST ìš”ì²­
               $.ajax({
                   url: '/naverapi/generate_image',
                   method: 'POST',
                   contentType: 'application/json',
                   data: JSON.stringify({
                       key_word: selectedType,
                       request_type: selectedImage
                   }),
                   success: function (response) {
                       // ì„œë²„ì—ì„œ ë°ì´í„°ê°€ ë¹ˆ ê²½ìš° ì²˜ë¦¬
                       if (response.length === 0) {
                           $('#imageContainer').html('<p class="text-center">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>');
                       } else {
                           renderImages(response);
                       }
                   },
                   error: function () {
                       alert('Error generating images.');
                   },
                   complete: function () {
                       $('#loadingModal').modal('hide');
                   }
               });
           });


           const renderImages = (images) => {
               const imageContainer = $('#imageContainer');

               images.forEach(image => {
                   const imageHtml = `
                       <div class="card mb-4">
                           <div class="card-body">
                               <div class="row">
                                   <div class="col-md-4 text-center">
                                       <img src="${image.url}" alt="${image.title_image}" style="width: 100%; height: auto;" />
                                   </div>
                                   <div class="col-md-8">
                                       <h5>${image.title_image}</h5>
                                       <p><strong>Update Date:</strong> ${image.update_date}</p>
                                       <p><strong>Thumbnail:</strong> ${image.thumbnail}</p>
                                   </div>
                               </div>
                           </div>
                       </div>
                   `;
                   imageContainer.append(imageHtml);
               });
           };

           const loadImages = () => {
               $.ajax({
                   url: '/naverapi/admin_image',
                   method: 'GET',
                   data: { 
                    page: currentPage, 
                    per_page: perPage 
                },
                success: function (response) {
                    if (response.data.length > 0) {
                        let currentIndex = currentPage * 10; // í˜„ì¬ í˜ì´ì§€ì— ê¸°ë°˜í•˜ì—¬ ì¸ë±ìŠ¤ ìƒì„±

                response.data.forEach((image, index) => { // JavaScriptì—ì„œ ê³ ìœ  ì¸ë±ìŠ¤ ìƒì„±
                    const uniqueIndex = currentIndex + index + 1; // í˜ì´ì§€ì™€ ë¡œì»¬ ì¸ë±ìŠ¤ë¥¼ ë”í•´ ê³ ìœ  ì¸ë±ìŠ¤ ìƒì„±

                    const imageHtml = `
                        <div class="card mb-4">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 text-center">
                                        <!-- ê¸°ë³¸ ì´ë¯¸ì§€ëŠ” JPG URL í‘œì‹œ -->
                                        <img id="image-${uniqueIndex}" src="${image.url}" alt="${image.title_image}" style="width: 100%; height: auto;" />
                                    </div>
                                    <div class="col-md-8">
                                        <!-- ì´ìœ ë²„íŠ¼ë“¤ -->
                                        <button class="btn btn-outline-primary btn-sm me-2" onclick="openFullscreen('${image.url}')">
                                            <i class="fas fa-search-plus"></i> í¬ê²Œ ë³´ê¸°
                                        </button>
                                        <button class="btn btn-outline-success btn-sm toggle-format" data-index="${uniqueIndex}" data-jpg="${image.url}" data-bmp="/naverapi/bmp_files/${image.bmp_file}">
                                            <i class="fas fa-sync-alt"></i> BMP ë³´ê¸°
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    $('#imageContainer').append(imageHtml);
                    });

                        // í˜ì´ì§€ ì¦ê°€
                        currentPage += 1;
                    } else {
                        alert("ë” ì´ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
                        $('#loadMoreBtn').hide();
                    }
                   },
                   error: function () {
                       alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                   }
               });
           };

           // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
           loadImages();

           
           // BMPì™€ JPG ì „í™˜ ë²„íŠ¼ ì²˜ë¦¬
            $(document).on("click", ".toggle-format", function () {
                const index = $(this).data("index");
                const imgElement = $(`#image-${index}`);
                const currentSrc = imgElement.attr("src");
                const jpgSrc = $(this).data("jpg");
                const bmpSrc = $(this).data("bmp");

                console.log("Index:", index);
                console.log("Current Src:", currentSrc);
                console.log("JPG Src:", jpgSrc);
                console.log("BMP Src:", bmpSrc);

                if (currentSrc === jpgSrc) {
                    // BMP ë³´ê¸°
                    const uniqueBmpSrc = `${bmpSrc}?t=${new Date().getTime()}`; // ìºì‹± ë°©ì§€
                    imgElement.attr("src", uniqueBmpSrc);
                    $(this).text("JPG ë³´ê¸°");
                    console.log("Switched to BMP");
                } else {
                    // JPG ë³´ê¸°
                    imgElement.attr("src", jpgSrc);
                    $(this).text("BMP ë³´ê¸°");
                    console.log("Switched to JPG");
                }
            });

           // "ë”ë³´ê¸°" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
           $('#loadMoreBtn').on('click', function () {
               console.log("ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­");
               if (currentPage == 1){
                 currentPage = 2;
                 loadImages();
               }
               loadImages();
           });


            // ì „ì²´ í™”ë©´ ì—´ê¸°
            $(document).on('click', '.btn-outline-primary', function () {
                const imageUrl = $(this).attr('onclick').match(/'(.*?)'/)[1]; // ì´ë¯¸ì§€ URL ì¶”ì¶œ
                const modal = $('#fullscreenModal');
                const fullscreenImage = $('#fullscreenImage');

                fullscreenImage.attr('src', imageUrl);
                modal.css('display', 'flex'); // ëª¨ë‹¬ ë³´ì´ê¸°
            });

            // ì „ì²´ í™”ë©´ ë‹«ê¸°
            $(document).on('click', '#fullscreenModal, #closeButton', function () {
                const modal = $('#fullscreenModal');
                modal.css('display', 'none'); // ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
            });

       });
   </script>
</body>
</html>
